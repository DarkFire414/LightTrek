<!DOCTYPE html>
<html>
    <head>
        <title>
            MC
        </title>
        <!-- Compiled and minified CSS -->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
        
        <!--
            Htmx: Librería para hacer request de datos desde html a flask mediante intervalos
            de tiempo
        -->
        <script src="https://unpkg.com/htmx.org@1.6.1"></script>

        <!-- Compiled and minified JavaScript -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.13.0/moment.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

        <link rel="stylesheet" href="../static/loader.css">

    </head>
    <body> 
        <h4 class="center">Simulación Montecarlo</h4>
        {% if msg is defined %}
            <p  class="center">{{msg}}</p>
        {% endif %}
        <div class="container margin">
            <div class="row" style="display: flex; justify-content: center; align-items: center;">
                <form action="" method="post" class="col s6">
                    <div class="row">
                        <h6>Establezca las condiciones iniciales</h6>
                    </div>
                    <div class="row">
                        <div class="col s12 input-field">
                            <input id="Num_fotones" name="Num_fotones" type="number" min="1" step="1" class="validate" required>
                            <label for="Num_fotones">Número de fotones</label>
                        </div>
                    </div>
                    <div class="row">
                        <h6>Parámetros del tejido</h6>
                    </div>
                    <div class="row">
                        <div class="col s6 input-field">
                            <input id="coef_abs" name="coef_abs" type="number" min="0.0001" max="1000.0000" step="0.0001" class="validate" required>
                            <label for="coef_abs">Coef. de Absorción &mu;a [cm^-1]</label>
                        </div>
                        <div class="col s6 input-field">
                            <input id="coef_esp" name="coef_esp" type="number" min="0.0001" max="1000.0000" step="0.0001" class="validate" required>
                            <label for="coef_esp">Coef. de Esparcimiento &mu;s [cm^-1]</label>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col s6 input-field">
                            <input id="coef_anis" name="coef_anis" type="number" min="-1.0000" max="1.0000" step="0.0001" class="validate" required>
                            <label for="coef_anis">Coef. de Anisotropía g</label>
                        </div>
                        <div class="col s6 input-field">
                            <input id="ind_ref" name="ind_ref" type="number" min="0.0001" max="1000.0000" step="0.0001" class="validate" required>
                            <label for="ind_ref">Índice de refracción n</label>
                        </div>
                    </div>   
                    <div class="row">
                        <label>Tipo de fuente: </label>
                        <select name="fuente" class="input-field validate" required>
                            <option value="" disabled selected>Elija un tipo de fuente</option>
                            <option value="1">Puntual Isotrópica</option>
                            <option value="2">Colimada</option>
                            <option value="3">Haz finito (radio de 5 cm)</option>
                        </select>
                    </div>    
                    <div class="center">
                        <button type="submit" class="btn teal">Iniciar
                        </button>
                        
                        <div hx-get="/progress" hx-trigger="every 1s"></div>
                        
                    </div>
                </form>
                
                <div class="col s6" style="height: 100%;";>
                    <canvas id="canvas" width="900" height="700"></canvas>
                    
                    <div class="row">
                        <div class="input-field col s6">
                          <input value="0.8" id="maxValueInput" type="number" min="0" step="0.1">
                          <label class="active" for="maxValueInput">Valor máximo a mostrar (cm)</label>
                        </div>
                        <div class="col s6">
                            <button class="btn teal" onclick="updateAxis()">Actualizar</button>
                        </div>
                    </div>
                    
                    {% if fileName is defined %}
                        <ul>
                            <li> - Número de fotones: {{Num_fotones}}</li>
                            <li> - Coef. de Absorción: {{coef_abs}}</li>
                            <li> - Coef. de Esparcimiento: {{coef_esp}}</li>
                            <li> - Coef. de Anisotropía: {{coef_anis}}</li>
                            <li> - Índice de refracción: {{ind_ref}}</li>
                            <li> - Tipo de fuente: {{fuente}}</li>
                        </ul>
                        <div class="center">
                            <a href="../{{fileName}}" download>
                                <input type="button" class="btn-small black" value="Descargar archivo de simulación" />
                            </a>
                        </div>
                    {% endif %}
                </div>

                <!--
                    El siguiente script evita el reenvío del formulario con los mismos
                    datos al recargar la página (no mover)
                -->
                <script>
                    if ( window.history.replaceState ) {
                        window.history.replaceState( null, null, window.location.href );
                    }
                </script>
                      
                <script type="text/javascript" src="./static/plot.js"></script>

                <script type="text/javascript">
                    {% if x is defined %}
                        //console.log("Simulación ejecutada");
                        //removeData();
                        updatePlot({{x|tojson}}, {{ y|tojson }});
                    {% else %}
                        //console.log("No sim");
                    {% endif %}
                </script>
                <script>
                      // Inicializar los campos de entrada (input-fields)
                    document.addEventListener('DOMContentLoaded', function() {
                        M.AutoInit(); // Inicializa todos los elementos de Materialize CSS en la página
                    });
                </script>
            </div>
        </div>
    </body>
</html>