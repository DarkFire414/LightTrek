<!DOCTYPE html>
<html>

<head>
    <title>
        MC
    </title>
    <link rel="icon" type="image/x-icon" href="../static/img/logo.ico">

    <!-- Compiled and minified CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">

    <!--
            Htmx: Librería para hacer request de datos desde html a flask mediante intervalos
            de tiempo
        -->
    <script src="https://unpkg.com/htmx.org@1.6.1"></script>

    <!-- Compiled and minified JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.13.0/moment.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <script src="../static/js/sidebar_handler.js"></script>

    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

    <link rel="stylesheet" href="../static/css/styles.css">
</head>

<body>
    <!--Sidenav-->
    <ul id="slide-out" class="sidenav sidenav-fixed ">
        <li>
            <div class="user-view">
                <div class="background">
                    <img src="https://picsum.photos/300/300" />
                </div>
                <a href="#"><img class="circle" src="../static/img/logo.png" /></a>
                <a href="#"><span class="white-text name">LightTrek</span></a>
                <a href="#"><span class="white-text email">Simulación</span></a>
            </div>
        </li>
        <li><a href="#" id="b1" onclick="buttonId(this.id)" sdelement="true"
                class="waves-effect blue-text text-darken-2">Introducción</a></li>
        <li><a href="#" id="b2" onclick="buttonId(this.id)" sdelement="true" class="waves-effect">Propiedades ópticas
                del
                tejido</a></li>
        <li>
            <div class="divider"></div>
        </li>
        <li><a class="subheader">Simulación</a></li>
        <li><a href="#" id="b3" onclick="buttonId(this.id)" sdelement="true" class="waves-effect" href="#!">Sistemas de
                coordenadas</a></li>
        <li><a href="#" id="b4" onclick="buttonId(this.id)" sdelement="true" class="waves-effect" href="#!">Una
                dimensión</a></li>
    </ul>

    <!--Contenido principal activo (incluyendo la navbar)-->
    <div class="main">
        <!--Navbar-->
        <div class="navbar-fixed">
            <nav class="indigo darken-3">
                <div class="nav-wrapper">
                    <div class="menuButton">
                        <a href="#" data-target="slide-out" class="sidenav-trigger show-on-large"><i
                                class="material-icons">menu</i></a>
                    </div>
                    <a href="#" class="brand-logo">LightTrek</a>
                </div>
            </nav>
        </div>
        <!--Contenido-->
        <div class="content container-fluid">
            <div id="pageb1" class="page" style="display: none;">
                <h3>Introducción</h3>

            </div>

            <div id="pageb2" class="page" style="display: none;">
                <h3>Propiedades ópticas del tejido</h3>
                <hr>
            </div>

            <div id="pageb3" class="page" style="display: none;">
                <h3>Sistemas de coordenadas</h3>
            </div>

            <div id="pageb4" class="page" style="display: none;">
                <h4>Simulación</h4>

                <div class="container-fluid">
                    <div class="row" style="display: flex; justify-content: center; align-items: center;">
                        <form action="" method="post" class="col s6">
                            <div class="row">
                                <h6>Características de la fuente luminosa</h6>
                            </div>
                            <div class="row">
                                <div class="input-field">
                                    <input id="Num_fotones" name="Num_fotones" type="number" min="1" step="1"
                                        class="validate" required>
                                    <label for="Num_fotones">Número de fotones</label>
                                </div>
                            </div>
                            <div class="row">
                                <label>Tipo de fuente: </label>
                                <select name="fuente" class="input-field validate" required>
                                    <option value="" disabled selected>Elija un tipo de fuente</option>
                                    <option value="1">Puntual Isotrópica</option>
                                    <option value="2">Colimada</option>
                                    <option value="3">Haz finito (radio de 5 cm)</option>
                                </select>
                            </div>
                            <br>
                            <div class="row">
                                <h6>Propiedades ópticas del tejido</h6>
                            </div>
                            <div class="row">
                                <div class="col s6 input-field">
                                    <input id="coef_abs" name="coef_abs" type="number" min="0.0001" max="1000.0000"
                                        step="0.0001" class="validate" required>
                                    <label for="coef_abs">Coef. de Absorción &mu;a [cm^-1]</label>
                                </div>
                                <div class="col s6 input-field">
                                    <input id="coef_esp" name="coef_esp" type="number" min="0.0001" max="1000.0000"
                                        step="0.0001" class="validate" required>
                                    <label for="coef_esp">Coef. de Esparcimiento &mu;s [cm^-1]</label>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col s6 input-field">
                                    <input id="coef_anis" name="coef_anis" type="number" min="-1.0000" max="1.0000"
                                        step="0.0001" class="validate" required>
                                    <label for="coef_anis">Coef. de Anisotropía g</label>
                                </div>
                                <div class="col s6 input-field">
                                    <input id="ind_ref" name="ind_ref" type="number" min="0.0001" max="1000.0000"
                                        step="0.0001" class="validate" required>
                                    <label for="ind_ref">Índice de refracción n</label>
                                </div>
                            </div>
                            <div class="center">
                                <button type="submit" class="btn teal">Iniciar
                                </button>

                                <div hx-get="/progress" hx-trigger="every 1s"></div>

                            </div>
                        </form>

                        <div class="col s6">
                            {% if msg is defined %}
                            <div class="row">
                                <div class="col s12 m6 offset-m3">
                                  <div class="card">
                                    <div class="card-content">
                                      <span class="card-title">
                                        <div class="row">
                                            <div class="col s3 center">
                                                <i class="small material-icons">notifications_active</i>
                                            </div>
                                            <div class="col s9">
                                                <p>Mensaje</p>
                                            </div>
                                        </div>
                                        </span>
                                      <p>{{msg}}</p>
                                    </div>
                                    <div class="card-action">
                                      <a class="btn" href="#!" onclick="scrollToSection('section1')">Resultados</a>
                                    </div>
                                  </div>
                                </div>
                            </div>
                            {% endif %}
                            <figure>
                                <img class="materialboxed"
                                    src="https://www.researchgate.net/publication/336609457/figure/fig2/AS:814980899303429@1571317996377/Conceptual-depiction-of-general-interactions-between-light-and-tissue.jpg"
                                    alt="Conceptual depiction of general interactions between light and tissue."
                                    style="width: 30vw;" />
                                <figcaption>Representación conceptual de las interacciones generales entre la luz y el
                                    tejido. <a href="#section1">[1]</a></figcaption>
                            </figure>
                        </div>

                    </div>
                    <h5 id="section1">Resultados</h5>
                    <div class="row" style="display: flex; justify-content: center; align-items: center;">
                        <div class="" style="width: 40vw;" ;>
                            <canvas id="canvas" width="900" height="700"></canvas>

                            <div class="row">
                                <div class="input-field col s6">
                                    <input value="0.8" id="maxValueInput" type="number" min="0" step="0.1">
                                    <label class="active" for="maxValueInput">Valor máximo a mostrar (cm)</label>
                                </div>
                                <div class="col s6">
                                    <button class="btn teal" onclick="updateAxis()">Actualizar</button>
                                </div>
                            </div>

                            {% if fileName is defined %}
                            <ul>
                                <li> - Número de fotones: {{Num_fotones}}</li>
                                <li> - Coef. de Absorción: {{coef_abs}}</li>
                                <li> - Coef. de Esparcimiento: {{coef_esp}}</li>
                                <li> - Coef. de Anisotropía: {{coef_anis}}</li>
                                <li> - Índice de refracción: {{ind_ref}}</li>
                                <li> - Tipo de fuente: {{fuente}}</li>
                            </ul>
                            <div class="center">
                                <a href="../{{fileName}}" download>
                                    <input type="button" class="btn-small black"
                                        value="Descargar archivo de simulación" />
                                </a>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
                <!--
                            El siguiente script evita el reenvío del formulario con los mismos
                            datos al recargar la página (no mover)
                        -->
                <script>
                    if (window.history.replaceState) {
                        window.history.replaceState(null, null, window.location.href);
                    }
                </script>

                <script type="text/javascript" src="./static/js/plot.js"></script>

                <script type="text/javascript">
                    {% if x is defined %}
                    //console.log("Simulación ejecutada");
                    //removeData();
                    updatePlot({{ x| tojson}}, {{ y| tojson }});
                    
                    {% else %}
                    //console.log("No sim");
                    {% endif %}
                </script>

                <br>
                <hr>
                <p class="reference" id="section1">[1] Recent Progress on Near-Infrared Photoacoustic Imaging: Imaging
                    Modality and
                    Organic Semiconducting Agents - Scientific Figure on ResearchGate. Available from: <a
                        href="https://www.researchgate.net/figure/Conceptual-depiction-of-general-interactions-between-light-and-tissue_fig2_336609457">Link</a>
                    [accessed 7 Aug, 2023]</p>
            </div>


        </div>
    </div>

    <script>
        $(document).ready(function () {
            var currentPage = localStorage.getItem('currentPage');
            if (currentPage) {
                buttonId(currentPage);
            }
            else {
                buttonId("b1");
            }
        });
    </script>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            M.AutoInit(); // Inicializa todos los elementos de Materialize CSS en la página
        });
    </script>
</body>

</html>